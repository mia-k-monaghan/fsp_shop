{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <div class="row pt-5">
    {% if ordered %}
    <div class="col-md-3 pt-4">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#Contents" aria-controls="Contents" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      <div class="collapse navbar-collapse" id="Contents">
        <ul class="navbar-nav flex-column">
          <li class="navbar-brand">Contents</li>
          <li class="nav-item"><a class="nav-link"href="#step1">Choose a Host</a></li>
          <li class="nav-item"><a class="nav-link"href="#step2">Upload Website Files</a></li>
          <li class="nav-item"><a class="nav-link"href="#step3">Setup a Database</a></li>
          <li class="nav-item"><a class="nav-link"href="#step4">Set Environment Variables</a></li>
          <li class="nav-item"><a class="nav-link"href="#step5">Install Requirements</a></li>
          <li class="nav-item"><a class="nav-link"href="#step6">Run Database Migrations</a> </li>
          <li class="nav-item"><a class="nav-link"href="#step7">Load Environment Variables in WSGI file</a></li>
          <li class="nav-item"><a class="nav-link"href="#step8">Set Website File Paths</a></li>
          <li class="nav-item"><a class="nav-link"href="#step9">Test the Website</a></li>
        </ul>
      </div>
      </nav>
    </div>
    <div class="col-md-9">
      <div class="text-center mx-auto">
        <p class="display-4">Deployment Guide</p>
        <p class="lead">What is deployment? Put simply, deployment is the process of
          storing your website files online, making it possible for people to see your
          website on the internet.<span id="step1"></span></p>
        </div>
        <hr>
        <p class="h3 pt-4">Step 1.	Choose a Host</p>
        <p>A website host stores the website files and makes the website accessible
          on the internet. There is a wide range of hosting services and platforms,
          but picking the right one depends on your needs. You must do your own
          sresearch to discover which host is right for you. </p>
        <p>At Full Stack Pak, we deploy using PythonAnywhere because they offer
          a free beginner account (you keep it forever and never have to upgrade),
           optional upgrading to allow a custom domain is affordable at $5.00 per
            month, and the deployment process is relatively straightforward and
            simple. The remainder of this Guide will refer to deployment on
            PythonAnywhere.</p>
        <p class="lead">Create a Free Beginner Account with PythonAnywhere or your preferred host.</p>
        <a class="btn btn-outline-dark mb-4" href="https://www.pythonanywhere.com/pricing/" target="blank">PythonAnywhere</a>

        <div class="py-2 mb-4 rounded bg-light container">
          <p><strong>Special note about the PythonAnywhere Free Beginner Account:</strong> When you
            sign up for the free beginner account with PythonAnywhere, your website
            domain will be yourusername.pythonanywhere.com. If you own a custom
            domain, you will not be able to use it with the Free PythonAnywhere Beginner
            Account—you must upgrade to the Hacker Account ($5.00 per month).</p>
            <p>If you want to stick with the free beginner account, consider choosing
              a username relevant to your business. For example, if your business name
              is Adventure Photography, consider choosing “adventurephotography” as your username
              so your website domain will be adventurephotography.pythonanywhere.com. Once
              you choose a username, you will not be able to change it without creating
              a new account.</p>
        </div>
        <p class="lead">After creating your account, click on the Web tab and select "Add a New Web App"</p>
        <img class="rounded img-fluid"src="{% static "img/deploy/add_a_web_app.png" %}" alt="">
        <p class="lead">Click "Next" to continue deploying with the free account.</p>
        <p class="lead">Select "Manual Configuration" and "Python3.7"</p>
        <img class="rounded img-fluid"src="{% static "img/deploy/manual_config.png" %}" alt="">
        <p class="lead">Click "Next to finish setting up the web application."</p>
        <img class="rounded img-fluid"src="{% static "img/deploy/setup_finish.png" %}" alt="">
        <br>
        <span id="step2"></span>

        <p class="h3 mt-5 pt-5">Step 2.	Upload Website Files</p>
        <p class="lead">Under the Files Tab, click ‘Upload File’ and upload the
          Simple Photo Pak zip file. After the upload is complete, click
          “Start a Bash Console Here”.</p>
        <img class="rounded img-fluid"src="{% static "img/deploy/upload_file.png" %}" alt="">
        <p class="lead pt-4">To unzip the file, enter the following into the console.</p>
<pre id='step3'class="col-md-10 bg-dark text-light"><code class="language-python">
unzip digital_art_pak.zip

</code></pre>


        <p class="h3 pt-4">Step 3.	Setup Database</p>
        <p class="lead">Click on the Databases Tab. If you have not yet initialized
          a database, click “Initialize MySQL Database”. Set a secure password for
          your database. After the database is initialized, take note of the username,
          host address, and database name. You will need to enter these variables
          into a file later.</p>
          <div class="py-2 mb-4 rounded bg-light container">
            <p><strong>Note about Databases: </strong>By default, the Simple
              Subscription Pak is set up to connect to a MySQL database. If you
              would like to change this setting, the database variables are located
              in the file location: <strong>digital_art_pak/.env</strong>, and additional database
              settings are located in the settings file located in :
              <strong>digital_art_pak/digital_art_pak/settings.py</strong>. Refer to the
              Django documentation for specific details pertaining to your
              preferred database.</p>
            <a id="step4"class="btn btn-outline-dark mb-4" href="https://docs.djangoproject.com/en/3.2/ref/databases/" target="blank">Django Documentation</a>
          </div>

          <p class="h3 pt-4">Step 4.	Set Environment Variables</p>
          <p>Each website has unique, identifying information stored in the form
            of variables. Most of these variables are stored in a secure .env file
            in the following location: <strong>digital_art_pak/.env</strong></p>
          <p>For your website to function, each variable in this file must be
            accurately set. The Simple Photo Pak contains the following variables:</p>
          <ul>
            <li><a href="#fullurl">FULL_URL</a> </li>
            <li><a href="#domain">DOMAIN_NAME</a> </li>
            <li><a href="#secretkey">SECRET_KEY</a></li>
            <li><a href="#email">EMAIL_HOST</a> </li>
            <li><a href="#email">EMAIL_HOST_USER</a> </li>
            <li><a href="#email">EMAIL_HOST_PASSWORD</a> </li>
            <li><a href="#email">DEFAULT_FROM_EMAIL</a> </li>
            <li><a href="#databasevariables">DATABASE_ENGINE</a> </li>
            <li><a href="#databasevariables">DATABASE_NAME</a> </li>
            <li><a href="#databasevariables">DATABASE_USER</a> </li>
            <li id="fullurl"><a href="#databasevariables">DATABASE_PASSWORD</a> </li>
            <li><a href="#databasevariables">DATABASE_HOST</a> </li>
            <li><a href="#debug">DEBUG</a> </li>
          </ul>

          <p class="h5">FULL_URL</p>
          <p>This variable refers to the full URL of your website, including the
          “https://” prefix. If using the Free Beginner PythonAnywhere account,
          the full website URL will be: <strong>https://yourusername.pythonanywhere.com</strong></p>
          <p>Example:</p>
<pre id="domain"class="col-md-10 bg-dark text-light"><code class="language-python">
FULL_URL='https://yourdomain.com'

</code></pre>
        <p class="h5">DOMAIN_NAME</p>
        <p>This variable refers to your domain. If using the Free Beginner
          PythonAnywhere account, your domain will be: <strong>yourusername.pythonanywhere.com</strong></p>
        <p>Example:</p>
<pre id="secretkey"class="col-md-10 bg-dark text-light"><code class="language-python">
DOMAIN_NAME='yourdomain.com'

</code></pre>

        <p class="h5">SECRET_KEY</p>
        <p>This variable refers to the Django Secret Key. The website will not
          function without a value set for this variable. Keep this variable secret!</p>
        <p class="lead">You can generate a Django secret key by using the Secret
          key generator at djecrety.ir</p>
        <a class="btn btn-outline-dark mb-4" href="https://djecrety.ir/" target="blank">Generate Secret Key</a>
        <p>Example:</p>
<pre id="email"class="col-md-10 bg-dark text-light"><code class="language-python">
SECRET_KEY='2@pluh&)#e0z@3_2dp)q6tx(dll*u^(x9-b5&z89$@md#2sc3%'

</code></pre>

        <p class="h5">EMAIL VARIABLES</p>
        <p>The following email variables enable the password recovery functionality
            of this website.</p>
        <div class="py-2 mb-4 rounded bg-light container">
          <p><strong>Note: </strong>If using a Free Beginner PythonAnywhere account, you will
          only be able to use a Gmail account—PythonAnywhere forbids other email providers
          and domains from being used with the Free Beginner account.</p>
        </div>

        <p class="lead">Refer to your email provider's SMTP documentation for the following variables.</p>
        <div class="row">
          <div class="col-md-12 mx-auto">
            <a class="btn btn-outline-dark mb-4 mr-2" href="https://support.google.com/mail/answer/7126229?hl=en" target="blank">Gmail</a>
            <a class="btn btn-outline-dark mb-4 mr-2" href="https://support.microsoft.com/en-us/office/pop-imap-and-smtp-settings-for-outlook-com-d088b986-291d-42b8-9564-9c414e2aa040" target="blank">Outlook</a>
            <a class="btn btn-outline-dark mb-4 mr-2" href="https://help.hover.com/hc/en-us/articles/217281777-Mail-server-settings-for-email-clients" target="blank">Hover</a>
            <a class="btn btn-outline-dark mb-4 mr-2" href="https://www.bluehost.com/help/article/email-application-setup" target="blank">BlueHost</a>
            <a class="btn btn-outline-dark mb-4 mr-2" href="https://www.zoho.com/mail/help/zoho-smtp.html" target="blank">Zoho Mail</a>
            <a class="btn btn-outline-dark mb-4 mr-2" href="https://help.dreamhost.com/hc/en-us/articles/214918038-Email-client-configuration-overview" target="blank">Dreamhost</a>
          </div>
        </div>
        <ul>
          <li><strong>EMAIL_HOST: </strong>Your email provider's SMTP server name.</li>
          <li><strong>EMAIL_HOST_USER: </strong>Your email account name, username,
            or email address. Some providers require username only, while others
            like Gmail require the full email address. Check with your provider
            for proper format.</li>
          <li><strong>EMAIL_HOST_PASSWORD: </strong>Your email account password.</li>
          <li><strong>DEFAULT_FROM_EMAIL: </strong>Your full email address.</li>
        </ul>
        <p>Example:</p>
<pre class="col-md-10 bg-dark text-light"><code class="language-python">
EMAIL_HOST='smtp.gmail.com'
EMAIL_HOST_USER='yourusername@gmail.com'
EMAIL_HOST_PASSWORD='s3cur3p4ssw0rd'
DEFAULT_FROM_EMAIL='yourusername@gmail.com'

</code></pre>
        <div class="py-2 mb-4 rounded bg-light container">
          <p id="databasevariables"><strong>Note: </strong>By default, The Simple
            Photo Pak sets the outgoing port to 587 using TLS. If you want to
            change these settings, they are located in <strong>digital_art_pak/digital_art_pak/settings.py</strong>. </p>
        </div>

        <p class="h5">DATABASE VARIABLES</p>
        <p class="lead">Refer to the database name, user, and host variables on the
          <strong>Databases</strong> Tab where you initialized the MySQL database in Step 3. Set each
          variable as indicated below.</p>
          <ul>
            <li><p><strong>ENGINE:</strong> By default, the database engine is set to the Django MySQL backend.
              If you initiated a MySQL database, this variable does not need to be changed.
              If you are using a different database, visit the Django backend documentation
              to reference the correct Engine variable.</p>
              <a class="btn btn-outline-dark mb-4" href="https://docs.djangoproject.com/en/3.2/ref/databases/" target="blank">Django Documentation</a>
              </li>
              <li><strong>NAME:</strong> The database name created upon initialization, typically your
                username + "$default"</li>
              <li><strong>USER:</strong> The username for the database, typically your PythonAnywhere username. </li>
              <li><strong>PASSWORD:</strong> The password you set upon database initialization</li>
              <li><strong>HOST:</strong> The host address for the database.</li>
          </ul>
          <p>Example:</p>
<pre id="debug"class="col-md-10 bg-dark text-light"><code class="language-python">
DATABASE_ENGINE='django.db.backends.mysql'
DATABASE_NAME='yourusername$default'
DATABASE_USER='yourusername'
DATABASE_PASSWORD='s3cur3p4ssw0rd'
DATABASE_HOST='yourusername.mysql.pythonanywhere-services.com'

</code></pre>
          <p class="h5">DEBUG</p>
          <p>By default, debug is set to TRUE. If set to TRUE, the Debug variable
            nstructs the website to display traceback messages in the event of an
            error. It also changes how the website fetches media files.</p>
            <p class="lead">Ensure DEBUG is set to True for initial deployment.</p>
            <div class="py-2 mb-4 rounded bg-light container">
              <p>Note: </strong>Make sure you switch DEBUG to False before
                production. You will not want website visitors seeing details about
                your code. <strong id="step5">The DEBUG variable should always be set to ‘True’ or ‘False’,
                  with the first letter capitalized.</strong></p>
            </div>

            <p class="h3 pt-4">Step 5.	Install Requirements</p>
            <p class="lead">The Simple Photo Pak Website requires some
              installations on the console to function properly. Perform the
              installations by completing the steps below.</p>
            <ol>
              <li class="pb-4">Navigate to the <strong>Consoles</strong> tab and click on the
                console used to unzip the project file.</li>
                <img class="rounded img-fluid"src="{% static "img/deploy/console.png" %}" alt="">
              <li>This website was built with Python3.7, so create a Virtual
                Environment by entering the following into the console: </li>
<pre class="col-md-10 bg-dark text-light"><code class="language-python">virtualenv -p python3.7 venv
</code></pre>
              <li>Activate the environment with the following command:</li>
<pre class="col-md-10 bg-dark text-light"><code class="language-python">source venv/bin/activate
</code></pre>
              <li>Navigate to the project folder: </li>
<pre class="col-md-10 bg-dark text-light"><code class="language-python">cd digital_art_pak/
</code></pre>
<li>Install the requirements: </li>
<pre class="col-md-10 bg-dark text-light"><code class="language-python">pip install -r requirements.txt
</code></pre>

            </ol>
            <p class="lead">Keep the console open for Step 6.</p>
            <div class="py-2 mb-4 rounded bg-light container">
              <p id="step6"><strong>Note: </strong>Some of these commands (step 2 and 5)
                may take more than a few minutes to complete. This is normal!
                Enter the next command after the previous command has finished
                running.</p>
            </div>

            <p class="h3 pt-4">Step 6.	Run Database Migrations</p>
            <p class="lead">The Simple Photo Pak comes with a fully
              developed database to run your business. Migrate the database
              design to your MySQL database by entering the following command
              into the console:</p>
<pre class="col-md-10 bg-dark text-light"><code class="language-python">python manage.py migrate
</code></pre>
            <p><strong>This command may take up to an hour to complete. This is normal!</strong></p>
            <p class="lead">Create your website administrator account by entering
              the following command into the console:</p>
<pre class="col-md-10 bg-dark text-light"><code class="language-python">python manage.py createsuperuser
</code></pre>
            <p id="step7"class="lead">Follow the prompts for setting a username and password.</p>

            <p class="h3 pt-4">Step 7.	Load Environment Variables in WSGI file</p>
            <p>For The Simple Photo Pak to function properly,
              the application must be told where to find the environment variables set in Step 4.
              To do this, complete the steps below.</p>
            <p class="lead">Navigate to the <strong>Web</strong> tab. Under the
              <strong>Code</strong> Section, click on the link to the WSGI
              configuration file. Delete all the code in the file and replace with
              the following:</p>

<pre class="col-md-10 bg-dark text-light"><code class="language-python">
import os
import sys

path = '/home/yourusername/digital_art_pak'
if path not in sys.path:
  sys.path.append(path)

from dotenv import load_dotenv
load_dotenv(os.path.join(path, '.env'))

os.environ['DJANGO_SETTINGS_MODULE'] = 'digital_art_pak.settings'

from django.core.wsgi import get_wsgi_application
application = get_wsgi_application()

</code></pre>
          <p><strong>Be sure to replace <em>yourusername</em> with your PythonAnywhere username!</strong></p>
          <p id="step8"class="lead">Save the file and return to the <strong>Web</strong> tab.</p>

          <p class="h3 pt-4">Step 8.	Set Website File Paths</p>
          <p>For The Simple Photo Pak to function properly, you must tell
            the application where to find the website source code, virtual environment
            (created in Step 5), website images, styling, and media.</p>
          <p class="lead">Under the Code Section, enter the path to the Source Code.
            The Source Code path is the path to the main project folder:</p>
<pre class="col-md-10 bg-dark text-light"><code class="language-python">/home/yourusername/digital_art_pak
</code></pre>
          <p class="lead">Under the Virtualenv Section, enter the path to the
            virtual environment created in Step 5: </p>
<pre class="col-md-10 bg-dark text-light"><code class="language-python">/home/yourusername/venv
</code></pre>

          <p>Website Images, uploaded media, and CSS styling are stored in folders.
            Declaring their file paths on the Web tab allows the website to load faster.</p>
          <p class="lead">Under the Static Files Section, enter the URL and Path values for each folder as shown below.</p>
          <table class="table">
            <tr>
              <th></th>
              <th>URL</th>
              <th>PATH</th>
            </tr>
            <tr>
              <td><strong>Static Folder</strong></td>
              <td>/static/</td>
              <td>/home/<em>yourusername</em>/digital_art_pak/static</td>
            </tr>
            <tr>
              <td><strong>Admin Static Folder</strong></td>
              <td>/static/admin/</td>
              <td>/home/<em>yourusername</em>/venv/lib/python3.7/site-packages/django/contrib/admin/static/admin</td>
            </tr>
            <tr>
              <td id="step9"><strong>Media Folder</strong></td>
              <td>/media/</td>
              <td>/home/<em>yourusername</em>/digital_art_pak/media</td>
            </tr>
          </table>

          <p class="h3 pt-4">Step 9.	Test the Website</p>
          <p>Ensure the following PythonAnywhere, Stripe, and Email account settings are
            correctly set before testing.</p>
            <p class="h5">PYTHONANYWHERE ACCOUNT SETTINGS</p>
            <p>The Website application is now ready for testing. Complete the
              steps below to finish deployment.</p>

              <p class="lead">On the Web tab under the Security section, enable
                Force HTTPS. Reload the Web Application at the top of the page.</p>
                <p class="lead">Click on your website URL at the top of the Web tab to visit
                  your deployed website!
                  <div class="py-2 mb-4 rounded bg-light container">
                    <p><strong>Note: </strong>If you experience any errors, visit the
                      error logs on the Web tab to diagnose and solve the issue. Don’t
                      forget to set the DEBUG variable to False in the .env file after
                      testing. Always reload the application for changes to go into effect.</p>
                    </div>
                    <div class="py-2 mb-4 rounded bg-light container">
                      <p><strong>Note on Password Protection: </strong>Under the Security
                        section, PythonAnywhere provides an option to password protect
                        your website while it is under development. Feel free to use this
                        feature, but keep in mind that Stripe webhooks will not work while
                        this feature is turned on.</p>
                      </div>
          <p class="h5">EMAIL ACCOUNT SETTINGS</p>
          <p class="lead">If using a free Gmail account, go to
            the <strong>Gmail Account Settings</strong> and click <strong>Security</strong>.
            Under the <strong>Less Secure App Access</strong> section, click to
            allow less secure apps. If this setting is not turned on, Gmail will
            block the account from sending password recovery emails.</p>
            <div class="py-2 mb-4 rounded bg-light container">
              <p><strong>Note: </strong>The above email settings only apply if using a Gmail Account.</p>
            </div>
            <p class="h5">STRIPE ACCOUNT SETTINGS</p>
            <p class="font-weight-bold">Add Stripe API Keys to Pak Settings</p>
            <p>All Full Stack Paks are set up by default to connect with your Stripe account
            to process payments. You don’t need plugins or extra code—just enter your Stripe
            API keys into your Pak Settings. (You can find <strong>Pak settings </strong>by clicking the <strong>gear icon</strong> on the Navbar of your website)</p>
          <p>If you don’t already have one, you can sign up for a Stripe account
            for free. After signup, test API keys will be ready for immediate use.
            After verifying your business details, live keys are available and you
            can start accepting payments on your website.</p>
          <a class="btn btn-outline-dark mb-4" href="https://stripe.com/" target="blank">Get a Stripe Account</a>
          <p>You can find your test and live keys on your Stripe Dashboard under
            <strong>API Keys</strong> in the <strong>Developers</strong> section.
            Copy and paste your Stripe Keys into your Pak Settings.</p>
            <p class="font-weight-bold">Add Webhook Endpoint</p>
              <p>If you are unfamiliar with Stripe webhooks, their purpose is to listen
                for specific events related to Stripe activities (completed payments,
                canceled subscriptions, etc) and update your website database accordingly.</p>
              <p class="lead">For completed orders to show up on the website administration page,
                you must create a Stripe Webhook endpoint. Create a Stripe webhook by
                completing these steps:</p>
              <ol>
                <li>In your Stripe Dashboard, navigate to <strong>Webhooks</strong>
                  under the <strong>Developers</strong> Section</li>
                <li>Click “Add Endpoint”</li>
                <li>Enter your full website url followed by “/webhooks” into the Endpoint
                  URL field. If you are using a Free Beginner PythonAnywhere domain,
                  the Endpoint URL will be <strong>https://yourusername.pythonanywhere.com/webhooks</strong></li>
                <li>Listen for the below event:</li>
                <ul>
                  <li><strong>Checkout.session.completed</strong></li>
                </ul>
              </ol>
              <img style="width:30em;"class="rounded img-fluid"src="{% static "img/deploy/webhook_setup.PNG" %}" alt="">
              <div class="py-2 mb-4 rounded bg-light container">
                <p><strong>Note: </strong>If either of the webhook requirements are not
                  satisfied, or the Endpoint URL is misspelled (Example: it reads
                  <strong>https://yourdomain.com/webhooks/</strong> instead of <strong>https://yourdomain.com/webhooks</strong>
                  , the website will not function properly and will fail to track subscription
                  orders and fulfillment on the website administration page.</p>
              </div>
              <p class="lead">Once created, the webhook endpoint will have a signing
                secret key. Click to reveal the key and save it in your Pak Stripe
                Settings with your Stripe Seceret and Publishable API Keys.</p>
            <div class="py-2 mb-4 rounded bg-light container">
              <p><strong>Note on Testing Stripe Integration: </strong>To test Stripe integration, add a test
                product in your Photo Pak administration page.
                View the test product on your website and click Add to Cart. Click on the Cart and Checkout. Use the
                test credit card number 4242 4242 4242 4242 to test Stripe Checkout Integration.</p>

                <p class="font-weight-bold">Don't forget to switch to your live
                  Stripe API keys after testing! </p>
                </div>

    </div>
  {% else %}
  <div class="mb-5 pb-5 text-center mx-auto">
    <p class="display-4 pb-4">Nothing to See Here!</p>
    <hr>
    <p class="lead">You don't have permission to view this page.</p>
    <p class="lead mb-5 pb-5">Login to view deployment guides, or contact support@fullstackpak.com if
      you're having trouble viewing your resources.</p>

  </div>
  {% endif %}

  </div>

</div>
{% endblock content %}

{% block extra_scripts %}
  <script type="text/javascript">
  // Select all links with hashes
$('a[href*="#"]')
// Remove links that don't actually link to anything
.not('[href="#"]')
.not('[href="#0"]')
.click(function(event) {
 // On-page links
 if (
   location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '')
   &&
   location.hostname == this.hostname
 ) {
   // Figure out element to scroll to
   var target = $(this.hash);
   target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
   // Does a scroll target exist?
   if (target.length) {
     // Only prevent default if animation is actually gonna happen
     event.preventDefault();
     $('html, body').animate({
       scrollTop: target.offset().top
     }, 500, function() {
       // Callback after animation
       // Must change focus!
       var $target = $(target);
       $target.focus();
       if ($target.is(":focus")) { // Checking if the target was focused
         return false;
       } else {
         $target.attr('tabindex','-1'); // Adding tabindex for elements not focusable
         $target.focus(); // Set focus again
       };
     });
   }
 }
});
  </script>
{% endblock extra_scripts %}
